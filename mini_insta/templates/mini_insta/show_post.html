<!-- 
File: show_post.html
Author: Ruby Chen (rc071404@bu.edu), 7/14/2004
Description: This is the singular post template for the mini_insta app.
-->

{% extends 'mini_insta/base.html' %}

{% block content %}


    <post>
        <hr>
        <!-- Header of post states who's post -->
        <div class="post-header">
            <h2>Post by {{ post.profile.username }}</h2>
        </div>

        <!-- Loops throough all photos linked to a singular post 
         and displays them with a timestamp and caption -->
        <div class="post_photo">

            <!-- if there are photos then display them or else 
             state no images available and just display the caption -->
            {% if post.get_all_photos %}
                {% for photo in post.get_all_photos %}
                    <div>
                        <img src="{{ photo.get_image_url }}">
                        <p>taken on {{ photo.timestamp }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>No images are available for this post</p>
            {% endif %}

            <!-- the caption -- displays the caption with scriplet code-->
            <p><strong>@{{ post.profile.username }}</strong>: {{ post.caption }}</p>
            <p>Posted on {{ post.timestamp }}</p>

            <form action="{% url 'update_post' post.pk %}" method="get" style="display:inline;">
                    <button type="submit" class="primary buttons">Update</button>
            </form>
            <form action="{% url 'delete_post' post.pk %}" method="get" style="display:inline;">
                    <button type="submit" class="primary buttons">Delete</button>
            </form>
        </div>

        <hr>

        <!-- Displays the first user who liked the post using a slice filter,
        and if thereâ€™s more than one like, it shows how many additional
        users liked the post. -->

            <div class="like-section">
                {% with post.get_likes as get_likes %}
                    {% if get_likes.count > 0 %}
                        <p>Liked by</p>
                        {% for like in get_likes|slice:":1" %}
                            <strong>@{{ like.profile.username }}</strong>
                        {% endfor %}

                        {% if get_likes.count > 1 %}
                            and <strong>{{ get_likes.count|add:"-1" }} others</strong>
                        {% endif %}
                
                    {% else %}
                        <p>No likes yet.</p>
                    {% endif %} 
                {% endwith %}
            </div>


       <!-- Comment section -- retrieves all comments using get_all_comments
        if there are no comments then it displays that there are no comments-->
        <h3>Comments</h3>
        {% if post.get_all_comments %}
            <ul class="comments-list">
                {% for comment in post.get_all_comments %}
                    <li class="comment">
                        <strong>@{{ comment.profile.username }}</strong>: {{ comment.text }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No comments yet. Be the first to comment!</p>
        {% endif %}

    </post>


{% endblock %}