<!-- 
File: show_feed.html
Author: Ruby Chen (rc071404@bu.edu), 7/14/2004
Description: This shows a personalized feed of the user 
only displaying posts from the users they 
-->

{% extends 'mini_insta/base.html' %}

{% block content %}

    <hr>
    <!-- Header of the profiles feed -->
            
            <div class="post-header">
                <h2>@{{ profile.username }}'s Feed</h2>
            </div>

            <!-- Display each post from the profiles that the user is following -->
            <div class="feed">
            {% if posts %}
                {% for post in posts %}

                    <!-- Loops throough all photos linked to a profiles following 
                    and displays caption, likes, and comments -->
                    <div class="post_photo">
                        {% if post.get_all_photos %}
                            <img src="{{ post.get_all_photos.0.get_image_url }}" alt="Post image" class="feed-photo">
                        {% endif %}
                    </div>

                    <!-- Like count -->


                        <!-- Displays the first user who liked the post using a slice filter,
                        and if thereâ€™s more than one like, it shows how many additional
                        users liked the post. -->

                        <div class="like-section">
                            {% with post.get_likes as get_likes %}
                                {% if get_likes.count > 0 %}
                                    <p>Liked by</p>
                                    {% for like in get_likes|slice:":1" %}
                                        <strong>@{{ like.profile.username }}</strong>
                                    {% endfor %}

                                    {% if get_likes.count > 1 %}
                                        and <strong>{{ get_likes.count|add:"-1" }} others</strong>
                                    {% endif %}
                            
                                {% else %}
                                    <p>No likes yet.</p>
                                {% endif %} 
                            {% endwith %}
                    
                        </div>

                    <!-- the caption -- displays the caption with scriplet code-->
                    <div class="post-captions">
                        <p><strong>@{{ post.profile.username }}</strong>: {{ post.caption }}</p>
                        <p>Posted on {{ post.timestamp }}</p>
                    </div>

                    
                    <!-- Comment section -- retrieves all comments using get_all_comments
                     if there are no comments then it displays that there are no comments-->
                        <h3>Comments</h3>
                        {% if post.get_all_comments %}
                            <div class="comments-list">
                                {% for comment in post.get_all_comments %}
                                    <p><strong>@{{ comment.profile.username }}</strong>: {{ comment.text }}</p>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p>No comments yet.</p>
                        {% endif %}

        
                </div>
                <hr>
                {% endfor %}

            <!-- If the user follower no one that means there will be no 
            posts in their feed -->
            {% else %}
                <p>No posts available in your feed.</p>
            {% endif %}
            </div>  

{% endblock %}
